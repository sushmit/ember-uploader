// ==========================================================================
// Project:   Ember Uploader - v0.2.8
// Homepage:  https://github.com/benefitcloud/ember-uploader
// Copyright: Â©2015 Joshua Borton
// Licensed:  MIT
// ==========================================================================

(function(){var a=Ember.get,b=Ember.set;function c(a){a=a||"";return a.replace(/[^\x00-\x7F]/g,"_")}Ember.Uploader=Ember.Object.extend(Ember.Evented,{url:null,paramNamespace:null,paramName:"file",type:"POST",upload:function(c,d,e){d=d||{};var f=this.setupFormData(c,d);var g=a(this,"url");var h=a(this,"type");var i=this;b(this,"isUploading",true);return this.ajax(g,f,h,e).then(function(a){i.didUpload(a);return a})},setupFormData:function(a,b){var d=new FormData;for(var e in b){if(b.hasOwnProperty(e)){d.append(this.toNamespacedParam(e),b[e])}}if(Ember.isArray(a)){for(var f=a.length-1;f>=0;f--){d.append(this.toNamespacedParam(this.paramName),a[f],c(a[f].name))}}else{d.append(this.toNamespacedParam(this.paramName),a,c(a.name))}return d},toNamespacedParam:function(a){if(this.paramNamespace){return this.paramNamespace+"["+a+"]"}return a},didUpload:function(a){b(this,"isUploading",false);this.trigger("didUpload",a)},didProgress:function(a){a.percent=a.loaded/a.total*100;this.trigger("progress",a)},abort:function(){b(this,"isUploading",false);this.trigger("isAborting")},ajax:function(a,b,c,d){var e=this;var f={url:a,type:c||"POST",contentType:false,processData:false,xhr:function(){var a=Ember.$.ajaxSettings.xhr();a.upload.onprogress=function(a){e.didProgress(a)};e.one("isAborting",function(){a.abort()});return a},data:b};if(d){f.headers=d}return this._ajax(f)},_ajax:function(a){return new Ember.RSVP.Promise(function(b,c){a.crossDomain=true;a.xhrFields={withCredentials:true};a.success=function(a){Ember.run(null,b,a)};a.error=function(a,b,d){Ember.run(null,c,a)};Ember.$.ajax(a)})}})})();(function(){var a=Ember.get,b=Ember.set;Ember.S3Uploader=Ember.Uploader.extend({url:"/sign",headers:null,upload:function(a,c){var d=this;b(this,"isUploading",true);return this.sign(a,c).then(function(b){var c=null;if(b.region){c="//s3-"+b.region+".amazonaws.com/"+b.bucket;delete b.region}else{c="//"+b.bucket+".s3.amazonaws.com"}var e=d.setupFormData(a,b);return d.ajax(c,e)}).then(function(a){d.didUpload(a);return a})},sign:function(b,c){c=c||{};c.name=b.name;c.type=b.type;c.size=b.size;var d={url:a(this,"url"),headers:a(this,"headers"),type:"GET",contentType:"json",data:c};return this._ajax(d)}})})();(function(){var a=Ember.set;Ember.FileField=Ember.TextField.extend({type:"file",attributeBindings:["multiple"],multiple:false,change:function(b){var c=b.target;if(!Ember.isEmpty(c.files)){a(this,"files",c.files)}}})})();